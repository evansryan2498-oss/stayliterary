<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stay Lit Book Bingo</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Crimson Text', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #f0e6d2;
            min-height: 100vh;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .header h1 {
            font-size: 3em;
            color: #d4af37;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .header p {
            font-size: 1.3em;
            color: #f0e6d2;
            font-style: italic;
        }
        
        .elvish-text {
            font-size: 1.1em;
            color: #b8a070;
            margin-top: 10px;
            letter-spacing: 2px;
            opacity: 0.8;
        }
        
        .menu-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .menu-button {
            background: rgba(212, 175, 55, 0.2);
            border: 2px solid #d4af37;
            color: #f0e6d2;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Crimson Text', serif;
        }
        
        .menu-button:hover {
            background: rgba(212, 175, 55, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }
        
        .menu-button.active {
            background: #d4af37;
            color: #1a1a2e;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .dropdown {
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #d4af37;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 1.1em;
            color: #f0e6d2;
            cursor: pointer;
            min-width: 200px;
            font-family: 'Crimson Text', serif;
            transition: all 0.3s ease;
        }
        
        .dropdown:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #e5c158;
        }
        
        .dropdown-content {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #16213e;
            border: 2px solid #d4af37;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .dropdown-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.2s ease;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
        
        .dropdown-item:hover {
            background: rgba(212, 175, 55, 0.2);
        }
        
        .bingo-grid {
            display: grid;
            gap: 15px;
            margin: 30px auto;
            max-width: 900px;
        }
        
        .grid-2x2 { grid-template-columns: repeat(2, 1fr); }
        .grid-4x4 { grid-template-columns: repeat(4, 1fr); }
        .grid-3x3 { grid-template-columns: repeat(3, 1fr); }
        
        .bingo-square {
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 20px;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .bingo-square:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .bingo-square:hover .comment-button {
            opacity: 1;
        }
        
        .square-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .star-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px;
            padding: 5px;
            transition: transform 0.2s ease;
        }
        
        .star-button:hover {
            transform: scale(1.2);
        }
        
        .menu-dots {
            background: none;
            border: none;
            color: #d4af37;
            cursor: pointer;
            font-size: 24px;
            padding: 5px;
            position: relative;
        }
        
        .square-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: #16213e;
            border: 2px solid #d4af37;
            border-radius: 8px;
            padding: 8px 0;
            min-width: 150px;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .square-menu-item {
            padding: 10px 20px;
            cursor: pointer;
            transition: background 0.2s ease;
            color: #f0e6d2;
        }
        
        .square-menu-item:hover {
            background: rgba(212, 175, 55, 0.2);
        }
        
        .category-text {
            font-size: 1.1em;
            color: #f0e6d2;
            margin-bottom: 10px;
            flex-grow: 1;
        }
        
        .book-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #d4af37;
            border-radius: 5px;
            padding: 8px;
            color: #f0e6d2;
            font-family: 'Crimson Text', serif;
            font-size: 1em;
            margin-top: auto;
        }
        
        .book-input::placeholder {
            color: rgba(240, 230, 210, 0.5);
        }
        
        .book-title {
            font-style: italic;
            color: #e5c158;
            margin-top: 10px;
            padding: 8px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 5px;
        }
        
        .comment-button {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid #d4af37;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
        }
        
        .comment-button:hover {
            background: rgba(212, 175, 55, 0.4);
            transform: scale(1.1);
        }
        
        .comment-button.has-comments {
            opacity: 1;
        }
        
        .comment-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #d4af37;
            color: #1a1a2e;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7em;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .comment-modal {
            position: absolute;
            top: 100%;
            right: 0;
            background: #16213e;
            border: 2px solid #d4af37;
            border-radius: 8px;
            padding: 15px;
            min-width: 300px;
            max-width: 400px;
            z-index: 200;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            margin-top: 5px;
        }
        
        .comment-modal h3 {
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .comments-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .comment-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 3px solid #d4af37;
        }
        
        .comment-author {
            color: #e5c158;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.95em;
        }
        
        .comment-text {
            color: #f0e6d2;
            font-size: 0.95em;
        }
        
        .comment-input-section {
            border-top: 1px solid rgba(212, 175, 55, 0.3);
            padding-top: 15px;
        }
        
        .comment-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #d4af37;
            border-radius: 5px;
            padding: 8px;
            color: #f0e6d2;
            font-family: 'Crimson Text', serif;
            font-size: 0.95em;
            margin-bottom: 8px;
            resize: vertical;
            min-height: 60px;
        }
        
        .comment-input::placeholder {
            color: rgba(240, 230, 210, 0.5);
        }
        
        .comment-char-count {
            font-size: 0.85em;
            color: rgba(240, 230, 210, 0.6);
            margin-bottom: 8px;
        }
        
        .comment-char-count.limit-reached {
            color: #ff6b6b;
        }
        
        .comment-submit {
            background: #d4af37;
            color: #1a1a2e;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Crimson Text', serif;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .comment-submit:hover {
            background: #e5c158;
        }
        
        .comment-submit:disabled {
            background: rgba(212, 175, 55, 0.3);
            cursor: not-allowed;
        }
        
        .no-comments {
            color: rgba(240, 230, 210, 0.6);
            font-style: italic;
            text-align: center;
            padding: 20px;
        }
        
        .password-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .password-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 15px;
            border: 2px solid #d4af37;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }
        
        .password-box h2 {
            color: #d4af37;
            margin-bottom: 20px;
            font-size: 2em;
        }
        
        .password-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #d4af37;
            border-radius: 8px;
            padding: 12px;
            color: #f0e6d2;
            font-family: 'Crimson Text', serif;
            font-size: 1.1em;
            margin-bottom: 20px;
        }
        
        .password-button {
            background: #d4af37;
            color: #1a1a2e;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Crimson Text', serif;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .password-button:hover {
            background: #e5c158;
            transform: translateY(-2px);
        }
        
        .error-message {
            color: #ff6b6b;
            margin-top: 15px;
        }
        
        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .favorite-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .favorite-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
        }
        
        .favorite-person {
            color: #d4af37;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .favorite-category {
            color: #f0e6d2;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        
        .favorite-book {
            color: #e5c158;
            font-style: italic;
            font-size: 1.1em;
        }
        
        .how-to-section {
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .how-to-section p {
            color: #f0e6d2;
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .parameters-content {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .parameters-content h2 {
            color: #d4af37;
            margin-bottom: 20px;
            font-size: 2em;
        }
        
        .tier-section {
            margin-bottom: 30px;
        }
        
        .tier-section h3 {
            color: #e5c158;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .tier-section ul {
            list-style-position: inside;
            color: #f0e6d2;
        }
        
        .tier-section li {
            margin-bottom: 10px;
            font-size: 1.1em;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .header p { font-size: 1.1em; }
            .bingo-grid { gap: 10px; }
            .bingo-square { min-height: 120px; padding: 15px; }
            .grid-4x4 { grid-template-columns: repeat(2, 1fr); }
            .grid-3x3 { grid-template-columns: repeat(2, 1fr); }
            .comment-button { opacity: 1; }
            .comment-modal {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                right: auto;
                max-width: 90vw;
                max-height: 80vh;
                overflow-y: auto;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDl4gVieR0SFncspang1wig6UMnFXeVJUI",
            authDomain: "stay-literary.firebaseapp.com",
            projectId: "stay-literary",
            storageBucket: "stay-literary.firebasestorage.app",
            messagingSenderId: "13003449670",
            appId: "1:13003449670:web:0ef767734aad1fa5243147"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        const MessageCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
        );
        
        const CORRECT_PASSWORD = "staylit2025";
        
        const USERS = [
            "Ryan Evans-Casual",
            "Ryan Evans-Ambitious", 
            "Ryan Evans-Elite",
            "Jacqueline Evans-Casual",
            "Jacqueline Evans-Ambitious",
            "Jacqueline Evans-Elite",
            "Lauren Lemons-Casual",
            "Lauren Lemons-Ambitious",
            "Lauren Lemons-Elite",
            "Robert Lemons-Casual",
            "Robert Lemons-Ambitious",
            "Robert Lemons-Elite",
            "Abbie Lemons-Casual",
            "Abbie Lemons-Ambitious",
            "Abbie Lemons-Elite",
            "Claire Evans-Casual",
            "Claire Evans-Ambitious",
            "Claire Evans-Elite",
            "Anne Titus-Casual",
            "Anne Titus-Ambitious",
            "Anne Titus-Elite",
            "Jeremy Titus-Casual",
            "Jeremy Titus-Ambitious",
            "Jeremy Titus-Elite",
            "Sam Reams-Casual",
            "Sam Reams-Ambitious",
            "Sam Reams-Elite"
        ];

        const CATEGORIES = {
            "Casual": [
                "Over 400 Pages",
                "Book Before the Movie",
                "Book Published in 2025",
                "A Genre You Don't Usually Read"
            ],
            "Ambitious": [
                "Over 400 Pages",
                "Book Before the Movie",
                "Book Published in 2025",
                "A Genre You Don't Usually Read",
                "Trending on Social Media",
                "Translated",
                "Book Published Before You Were Born",
                "Take a Recommendation from a Friend",
                "Debut Author",
                "Around the World",
                "Same Author Twice",
                "Award Winner",
                "Genre Blend",
                "Time Hop",
                "From Your Shelf",
                "Your Choice"
            ],
            "Elite": [
                "Over 400 Pages",
                "Book Before the Movie",
                "Book Published in 2025",
                "A Genre You Don't Usually Read",
                "Complete the Middle Square on the Casual Card...Then Read One of Those Books",
                "Have Someone Blindly Give You a Book Recommendation",
                "Banned Book",
                "Written Before 1910",
                "Read a Trilogy, or 3 Books by the Same Author",
                "Read 40+ Books in 2026",
                "Read a Book on Theme with a Heritage/History Month, in that Month",
                "Read a Book as a Part of a Book Club",
                "Pulitzer Prize Winner"
            ]
        };

        function PasswordScreen({ onPasswordCorrect }) {
            const [password, setPassword] = useState("");
            const [error, setError] = useState("");

            const handleSubmit = (e) => {
                e.preventDefault();
                if (password === CORRECT_PASSWORD) {
                    onPasswordCorrect();
                } else {
                    setError("Incorrect password");
                }
            };

            return (
                <div className="password-container">
                    <div className="password-box">
                        <h2>Enter Password</h2>
                        <form onSubmit={handleSubmit}>
                            <input
                                type="password"
                                className="password-input"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                placeholder="Password"
                            />
                            <button type="submit" className="password-button">
                                Enter
                            </button>
                        </form>
                        {error && <div className="error-message">{error}</div>}
                    </div>
                </div>
            );
        }

        function CommentModal({ user, tier, squareIndex, category, onClose }) {
            const [comments, setComments] = useState([]);
            const [newComment, setNewComment] = useState("");
            const [charCount, setCharCount] = useState(0);
            const modalRef = useRef(null);
            const MAX_CHARS = 150;

            useEffect(() => {
                loadComments();
                
                function handleClickOutside(event) {
                    if (modalRef.current && !modalRef.current.contains(event.target)) {
                        onClose();
                    }
                }
                
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            const loadComments = async () => {
                const docId = `${user}-square_${squareIndex}`;
                const doc = await db.collection('comments').doc(docId).get();
                if (doc.exists) {
                    setComments(doc.data().comments || []);
                }
            };

            const handleCommentChange = (e) => {
                const text = e.target.value;
                if (text.length <= MAX_CHARS) {
                    setNewComment(text);
                    setCharCount(text.length);
                }
            };

            const handleSubmit = async () => {
                if (!newComment.trim()) return;
                
                const userName = user.split('-')[0];
                const comment = {
                    author: userName,
                    text: newComment.trim(),
                    timestamp: new Date().toISOString()
                };

                const docId = `${user}-square_${squareIndex}`;
                const updatedComments = [...comments, comment];
                
                await db.collection('comments').doc(docId).set({
                    comments: updatedComments
                });

                setComments(updatedComments);
                setNewComment("");
                setCharCount(0);
            };

            return (
                <div className="comment-modal" ref={modalRef}>
                    <h3>Comments</h3>
                    <div className="comments-list">
                        {comments.length === 0 ? (
                            <div className="no-comments">No comments yet. Be the first!</div>
                        ) : (
                            comments.map((comment, idx) => (
                                <div key={idx} className="comment-item">
                                    <div className="comment-author">{comment.author}</div>
                                    <div className="comment-text">{comment.text}</div>
                                </div>
                            ))
                        )}
                    </div>
                    <div className="comment-input-section">
                        <textarea
                            className="comment-input"
                            value={newComment}
                            onChange={handleCommentChange}
                            placeholder="Add a comment..."
                        />
                        <div className={`comment-char-count ${charCount === MAX_CHARS ? 'limit-reached' : ''}`}>
                            {charCount}/{MAX_CHARS}
                        </div>
                        <button 
                            className="comment-submit"
                            onClick={handleSubmit}
                            disabled={!newComment.trim()}
                        >
                            Post Comment
                        </button>
                    </div>
                </div>
            );
        }

        function BingoSquare({ category, index, user, tier, book, onBookChange, isFavorite, onToggleFavorite }) {
            const [showMenu, setShowMenu] = useState(false);
            const [showComments, setShowComments] = useState(false);
            const [commentCount, setCommentCount] = useState(0);
            const menuRef = useRef(null);
            const isOwner = user === user;

            useEffect(() => {
                loadCommentCount();
                
                function handleClickOutside(event) {
                    if (menuRef.current && !menuRef.current.contains(event.target)) {
                        setShowMenu(false);
                    }
                }
                
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, [user, index]);

            const loadCommentCount = async () => {
                const docId = `${user}-square_${index}`;
                const doc = await db.collection('comments').doc(docId).get();
                if (doc.exists && doc.data().comments) {
                    setCommentCount(doc.data().comments.length);
                }
            };

            const handleEdit = () => {
                const newBook = prompt("Edit book title:", book || "");
                if (newBook !== null) {
                    onBookChange(newBook);
                }
                setShowMenu(false);
            };

            const handleRemove = () => {
                if (confirm("Remove this book?")) {
                    onBookChange("");
                }
                setShowMenu(false);
            };

            return (
                <div className="bingo-square">
                    <div className="square-header">
                        <button 
                            className="star-button"
                            onClick={onToggleFavorite}
                        >
                            {isFavorite ? "⭐" : "☆"}
                        </button>
                        {isOwner && (
                            <div style={{ position: 'relative' }} ref={menuRef}>
                                <button 
                                    className="menu-dots"
                                    onClick={() => setShowMenu(!showMenu)}
                                >
                                    ⋮
                                </button>
                                {showMenu && (
                                    <div className="square-menu">
                                        <div className="square-menu-item" onClick={handleEdit}>
                                            Edit
                                        </div>
                                        <div className="square-menu-item" onClick={handleRemove}>
                                            Remove
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                    <div className="category-text">{category}</div>
                    {book ? (
                        <div className="book-title">{book}</div>
                    ) : isOwner ? (
                        <input
                            type="text"
                            className="book-input"
                            placeholder="Enter book title..."
                            onKeyPress={(e) => {
                                if (e.key === 'Enter') {
                                    onBookChange(e.target.value);
                                    e.target.value = '';
                                }
                            }}
                        />
                    ) : null}
                    
                    <div style={{ position: 'relative' }}>
                        <button 
                            className={`comment-button ${commentCount > 0 ? 'has-comments' : ''}`}
                            onClick={() => setShowComments(!showComments)}
                        >
                            <MessageCircle />
                            {commentCount > 0 && (
                                <span className="comment-count">{commentCount}</span>
                            )}
                        </button>
                        {showComments && (
                            <CommentModal
                                user={user}
                                tier={tier}
                                squareIndex={index}
                                category={category}
                                onClose={() => {
                                    setShowComments(false);
                                    loadCommentCount();
                                }}
                            />
                        )}
                    </div>
                </div>
            );
        }

        function BingoCard({ user, tier }) {
            const [books, setBooks] = useState({});
            const [favorites, setFavorites] = useState({});

            useEffect(() => {
                loadData();
            }, [user]);

            const loadData = async () => {
                const doc = await db.collection('bingo-cards').doc(user).get();
                if (doc.exists) {
                    setBooks(doc.data().books || {});
                    setFavorites(doc.data().favorites || {});
                }
            };

            const saveData = async (newBooks, newFavorites) => {
                await db.collection('bingo-cards').doc(user).set({
                    books: newBooks,
                    favorites: newFavorites
                });
            };

            const handleBookChange = async (index, book) => {
                const newBooks = { ...books, [index]: book };
                setBooks(newBooks);
                await saveData(newBooks, favorites);
            };

            const handleToggleFavorite = async (index) => {
                const newFavorites = { ...favorites, [index]: !favorites[index] };
                setFavorites(newFavorites);
                await saveData(books, newFavorites);
            };

            const categories = CATEGORIES[tier];
            const gridClass = tier === "Casual" ? "grid-2x2" : 
                            tier === "Elite" ? "grid-3x3" : "grid-4x4";

            return (
                <div className={`bingo-grid ${gridClass}`}>
                    {categories.map((category, index) => (
                        <BingoSquare
                            key={index}
                            category={category}
                            index={index}
                            user={user}
                            tier={tier}
                            book={books[index] || ""}
                            onBookChange={(book) => handleBookChange(index, book)}
                            isFavorite={favorites[index] || false}
                            onToggleFavorite={() => handleToggleFavorite(index)}
                        />
                    ))}
                </div>
            );
        }

        function FavoritesPage() {
            const [allFavorites, setAllFavorites] = useState([]);

            useEffect(() => {
                loadAllFavorites();
            }, []);

            const loadAllFavorites = async () => {
                const favorites = [];
                for (const user of USERS) {
                    const doc = await db.collection('bingo-cards').doc(user).get();
                    if (doc.exists) {
                        const data = doc.data();
                        const userFavorites = data.favorites || {};
                        const userBooks = data.books || {};
                        
                        const [name, tier] = user.split('-');
                        const categories = CATEGORIES[tier];
                        
                        Object.keys(userFavorites).forEach(index => {
                            if (userFavorites[index] && userBooks[index]) {
                                favorites.push({
                                    person: name,
                                    tier: tier,
                                    category: categories[index],
                                    book: userBooks[index]
                                });
                            }
                        });
                    }
                }
                setAllFavorites(favorites);
            };

            return (
                <div>
                    <div className="how-to-section">
                        <p>
                            Once you've completed a category, you can select the star in the top left corner 
                            and the book will be added to the Favorites page. This is a way to recommend 
                            your favorite book(s) to others!
                        </p>
                    </div>
                    <div className="favorites-grid">
                        {allFavorites.map((fav, index) => (
                            <div key={index} className="favorite-card">
                                <div className="favorite-person">{fav.person} - {fav.tier}</div>
                                <div className="favorite-category">{fav.category}</div>
                                <div className="favorite-book">{fav.book}</div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function ParametersPage() {
            return (
                <div className="parameters-content">
                    <h2>2026 Book Bingo Parameters</h2>
                    
                    <div className="tier-section">
                        <h3>Casual (4 books)</h3>
                        <ul>
                            <li>Over 400 Pages</li>
                            <li>Book Before the Movie</li>
                            <li>Book Published in 2025</li>
                            <li>A Genre You Don't Usually Read</li>
                        </ul>
                    </div>

                    <div className="tier-section">
                        <h3>Ambitious (16 books)</h3>
                        <ul>
                            <li>Over 400 Pages</li>
                            <li>Book Before the Movie</li>
                            <li>Book Published in 2025</li>
                            <li>A Genre You Don't Usually Read</li>
                            <li>Trending on Social Media</li>
                            <li>Translated</li>
                            <li>Book Published Before You Were Born</li>
                            <li>Take a Recommendation from a Friend</li>
                            <li>Debut Author</li>
                            <li>Around the World</li>
                            <li>Same Author Twice</li>
                            <li>Award Winner</li>
                            <li>Genre Blend</li>
                            <li>Time Hop</li>
                            <li>From Your Shelf</li>
                            <li>Your Choice</li>
                        </ul>
                    </div>

                    <div className="tier-section">
                        <h3>Elite (9 books)</h3>
                        <ul>
                            <li>Over 400 Pages</li>
                            <li>Book Before the Movie</li>
                            <li>Book Published in 2025</li>
                            <li>A Genre You Don't Usually Read</li>
                            <li>Complete the Middle Square on the Casual Card...Then Read One of Those Books</li>
                            <li>Have Someone Blindly Give You a Book Recommendation</li>
                            <li>Banned Book</li>
                            <li>Written Before 1910</li>
                            <li>Read a Trilogy, or 3 Books by the Same Author</li>
                            <li>Read 40+ Books in 2026</li>
                            <li>Read a Book on Theme with a Heritage/History Month, in that Month</li>
                            <li>Read a Book as a Part of a Book Club</li>
                            <li>Pulitzer Prize Winner</li>
                        </ul>
                    </div>
                </div>
            );
        }

        function App() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [selectedUser, setSelectedUser] = useState("");
            const [currentPage, setCurrentPage] = useState("home");
            const [showUserDropdown, setShowUserDropdown] = useState(false);

            if (!isAuthenticated) {
                return <PasswordScreen onPasswordCorrect={() => setIsAuthenticated(true)} />;
            }

            const userTier = selectedUser ? selectedUser.split('-')[1] : "";

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>Stay Lit Book Bingo 2026</h1>
                        <p>Track your literary journey</p>
                        <div className="elvish-text">Elen síla lúmenn' omentielvo</div>
                    </div>

                    <div className="menu-container">
                        <button 
                            className={`menu-button ${currentPage === 'home' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('home')}
                        >
                            Home
                        </button>
                        <button 
                            className={`menu-button ${currentPage === 'favorites' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('favorites')}
                        >
                            Favorites
                        </button>
                        <button 
                            className={`menu-button ${currentPage === 'parameters' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('parameters')}
                        >
                            Parameters
                        </button>
                    </div>

                    {currentPage === 'home' && (
                        <>
                            <div className="controls">
                                <div style={{ position: 'relative' }}>
                                    <div 
                                        className="dropdown"
                                        onClick={() => setShowUserDropdown(!showUserDropdown)}
                                    >
                                        {selectedUser || "Select Your Name & Tier"}
                                    </div>
                                    {showUserDropdown && (
                                        <div className="dropdown-content">
                                            {USERS.map(user => (
                                                <div 
                                                    key={user}
                                                    className="dropdown-item"
                                                    onClick={() => {
                                                        setSelectedUser(user);
                                                        setShowUserDropdown(false);
                                                    }}
                                                >
                                                    {user}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>

                            {selectedUser && (
                                <BingoCard user={selectedUser} tier={userTier} />
                            )}
                        </>
                    )}

                    {currentPage === 'favorites' && <FavoritesPage />}
                    {currentPage === 'parameters' && <ParametersPage />}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
