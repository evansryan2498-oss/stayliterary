<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stay Lit Book Bingo</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/evansryan2498-oss/stayliterary/main/StayLitLogoV2.png">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDl4gVieR0SFncspang1wig6UMnFXeVJUI",
            authDomain: "stay-literary.firebaseapp.com",
            projectId: "stay-literary",
            storageBucket: "stay-literary.firebasestorage.app",
            messagingSenderId: "13003449670",
            appId: "1:13003449670:web:0ef767734aad1fa5243147"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Lucide icons as inline SVG components
        const Menu = () => (
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        );
        
        const X = () => (
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );
        
        const BookOpen = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
        );
        
        const Info = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
        );
        
        const Award = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="8" r="7"></circle>
                <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
            </svg>
        );
        
        const Heart = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
        );
        
        const Star = ({ size = 20, fill = 'none', stroke = 'currentColor', strokeWidth = 2 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke={stroke} strokeWidth={strokeWidth}>
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
        );
        
        const MoreVertical = ({ size = 18, stroke = 'currentColor' }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={stroke} strokeWidth="2">
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="12" cy="5" r="1"></circle>
                <circle cx="12" cy="19" r="1"></circle>
            </svg>
        );

        const MessageCircle = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
        );
        
        const ChevronDown = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );
        const SearchableDropdown = ({ value, onChange, options, placeholder }) => {
    const [isOpen, setIsOpen] = useState(false);
    const [searchTerm, setSearchTerm] = useState('');
    const dropdownRef = useRef(null);
    const inputRef = useRef(null);

    useEffect(() => {
        const handleClickOutside = (event) => {
            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                setIsOpen(false);
                setSearchTerm('');
            }
        };

        document.addEventListener('mousedown', handleClickOutside);
        return () => document.removeEventListener('mousedown', handleClickOutside);
    }, []);

    const filteredOptions = options.filter(option =>
        option.toLowerCase().includes(searchTerm.toLowerCase())
    );

    const handleSelect = (option) => {
        onChange(option);
        setIsOpen(false);
        setSearchTerm('');
    };

    return (
        <div ref={dropdownRef} style={{ position: 'relative', width: '100%' }}>
            <div
                onClick={() => {
                    setIsOpen(!isOpen);
                    if (!isOpen) {
                        setTimeout(() => inputRef.current?.focus(), 0);
                    }
                }}
                style={{
                    width: '100%',
                    padding: '1rem',
                    fontSize: '1.1rem',
                    border: `2px solid ${isOpen ? '#879fbf' : '#c7f2ed'}`,
                    borderRadius: '10px',
                    backgroundColor: '#fffefc',
                    color: '#879fbf',
                    fontFamily: "'Crimson Text', serif",
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                    transition: 'all 0.2s ease',
                    boxShadow: isOpen ? '0 4px 8px rgba(135, 159, 191, 0.15)' : '0 2px 4px rgba(135, 159, 191, 0.1)',
                    outline: 'none'
                }}
            >
                <span style={{ flex: 1, color: value ? '#879fbf' : '#999' }}>
                    {value || placeholder}
                </span>
                <ChevronDown />
            </div>

            {isOpen && (
                <div style={{
                    position: 'absolute',
                    top: '100%',
                    left: 0,
                    right: 0,
                    marginTop: '0.5rem',
                    backgroundColor: '#fff',
                    border: '2px solid #879fbf',
                    borderRadius: '10px',
                    boxShadow: '0 8px 16px rgba(0,0,0,0.15)',
                    zIndex: 1000,
                    maxHeight: '300px',
                    overflow: 'hidden',
                    display: 'flex',
                    flexDirection: 'column'
                }}>
                    <div style={{ padding: '0.75rem', borderBottom: '1px solid #e0e0e0' }}>
                        <input
                            ref={inputRef}
                            type="text"
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            placeholder="Type to search..."
                            style={{
                                width: '100%',
                                padding: '0.75rem',
                                fontSize: '1rem',
                                border: '1px solid #c7f2ed',
                                borderRadius: '6px',
                                outline: 'none',
                                fontFamily: "'Crimson Text', serif",
                                color: '#879fbf'
                            }}
                            onClick={(e) => e.stopPropagation()}
                        />
                    </div>

                    <div style={{
                        overflowY: 'auto',
                        maxHeight: '240px'
                    }}>
                        {filteredOptions.length === 0 ? (
                            <div style={{
                                padding: '1rem',
                                color: '#999',
                                textAlign: 'center',
                                fontStyle: 'italic'
                            }}>
                                No names found
                            </div>
                        ) : (
                            filteredOptions.map((option, index) => (
                                <div
                                    key={index}
                                    onClick={() => handleSelect(option)}
                                    style={{
                                        padding: '1rem',
                                        cursor: 'pointer',
                                        borderBottom: index < filteredOptions.length - 1 ? '1px solid #f0f0f0' : 'none',
                                        backgroundColor: option === value ? '#f0fffc' : 'transparent',
                                        transition: 'background-color 0.15s'
                                    }}
                                    onMouseEnter={(e) => e.target.style.backgroundColor = '#f0fffc'}
                                    onMouseLeave={(e) => e.target.style.backgroundColor = option === value ? '#f0fffc' : 'transparent'}
                                >
                                    {option}
                                </div>
                            ))
                        )}
                    </div>
                </div>
            )}
        </div>
    );
};

        const LoginScreen = ({ onLogin }) => {
            const [password, setPassword] = useState('');
            const [error, setError] = useState(false);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (password.toLowerCase() === 'mellon') {
                    sessionStorage.setItem('stayLitAuthenticated', 'true');
                    onLogin();
                } else {
                    setError(true);
                    setPassword('');
                    setTimeout(() => setError(false), 2000);
                }
            };

            return (
                <div style={{
                    minHeight: '100vh',
                    display: 'flex',
                    flexDirection: 'column',
                    justifyContent: 'center',
                    alignItems: 'center',
                    backgroundColor: '#fffefc',
                    fontFamily: "'Crimson Text', serif",
                    padding: '2rem'
                }}>
                    <img 
                        src="https://raw.githubusercontent.com/evansryan2498-oss/stayliterary/main/StayLitLogoV2.png"
                        alt="Stay Literary"
                        style={{
                            height: 'clamp(150px, 25vw, 250px)',
                            width: 'auto',
                            marginBottom: '3rem',
                            display: 'block'
                        }}
                    />
                    <form onSubmit={handleSubmit} style={{
                        width: '100%',
                        maxWidth: '400px',
                        display: 'flex',
                        flexDirection: 'column',
                        gap: '1.5rem'
                    }}>
                        <div>
                            <label style={{
                                display: 'block',
                                marginBottom: '0.75rem',
                                fontSize: '1.3rem',
                                fontWeight: 600,
                                color: '#879fbf',
                                textAlign: 'center'
                            }}>
                                Enter Password
                            </label>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                placeholder="Password"
                                autoFocus
                                style={{
                                    width: '100%',
                                    padding: '1.25rem',
                                    fontSize: '1.2rem',
                                    border: error ? '2px solid #d32f2f' : '2px solid #879fbf',
                                    borderRadius: '10px',
                                    backgroundColor: '#fff',
                                    color: '#879fbf',
                                    fontFamily: "'Crimson Text', serif",
                                    outline: 'none',
                                    textAlign: 'center',
                                    transition: 'border-color 0.2s',
                                    boxSizing: 'border-box'
                                }}
                            />
                            <p style={{
                                fontSize: '0.9rem',
                                fontStyle: 'italic',
                                color: '#879fbf',
                                opacity: 0.6,
                                marginTop: '0.75rem',
                                textAlign: 'center',
                                lineHeight: 1.4
                            }}>
                                Ennyn Durin Aran StayLit. Pedo Mellon a Minno. Im Ryan hain echant. Celebrimbor o Eregion teithant i thiw hin.
                            </p>
                            {error && (
                                <p style={{
                                    color: '#d32f2f',
                                    fontSize: '1rem',
                                    marginTop: '0.5rem',
                                    textAlign: 'center'
                                }}>
                                    Incorrect password. Please try again.
                                </p>
                            )}
                        </div>
                        <button
                            type="submit"
                            style={{
                                width: '100%',
                                padding: '1.25rem',
                                fontSize: '1.2rem',
                                backgroundColor: '#879fbf',
                                color: '#fff',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 600,
                                fontFamily: "'Crimson Text', serif",
                                transition: 'background-color 0.2s',
                                boxSizing: 'border-box'
                            }}
                            onMouseOver={(e) => e.target.style.backgroundColor = '#6a8097'}
                            onMouseOut={(e) => e.target.style.backgroundColor = '#879fbf'}
                        >
                            Enter
                        </button>
                    </form>
                </div>
            );
        };

        const CommentModal = ({ docId, squareIndex, onClose, selectedName }) => {
            const [comments, setComments] = useState([]);
            const [newComment, setNewComment] = useState('');
            const [commenterName, setCommenterName] = useState(selectedName || '');
            const modalRef = useRef(null);
            const MAX_CHARS = 150;

            useEffect(() => {
                loadComments();
                
                function handleClickOutside(event) {
                    if (modalRef.current && !modalRef.current.contains(event.target)) {
                        onClose();
                    }
                }
                
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            const loadComments = async () => {
                const commentDocId = `${docId}-square_${squareIndex}`;
                const doc = await db.collection('comments').doc(commentDocId).get();
                if (doc.exists) {
                    setComments(doc.data().comments || []);
                }
            };

            const handleCommentChange = (e) => {
                const text = e.target.value;
                if (text.length <= MAX_CHARS) {
                    setNewComment(text);
                }
            };

            const handleDeleteComment = async (indexToDelete) => {
                const commentDocId = `${docId}-square_${squareIndex}`;
                const updatedComments = comments.filter((_, idx) => idx !== indexToDelete);
                
                await db.collection('comments').doc(commentDocId).set({
                    comments: updatedComments
                });

                setComments(updatedComments);
            };

            const handleSubmit = async () => {
                if (!newComment.trim() || !commenterName.trim()) return;
                
                const comment = {
                    author: commenterName.trim(),
                    text: newComment.trim(),
                    timestamp: new Date().toISOString()
                };

                const commentDocId = `${docId}-square_${squareIndex}`;
                const updatedComments = [...comments, comment];
                
                await db.collection('comments').doc(commentDocId).set({
                    comments: updatedComments
                });

                setComments(updatedComments);
                setNewComment('');
            };

            return (
                <div
                    ref={modalRef}
                    style={{
                        position: 'fixed',
                        top: '50%',
                        left: '50%',
                        transform: 'translate(-50%, -50%)',
                        backgroundColor: '#fff',
                        border: '2px solid #879fbf',
                        borderRadius: '12px',
                        padding: '1.5rem',
                        width: '90%',
                        maxWidth: '400px',
                        maxHeight: '80vh',
                        overflowY: 'auto',
                        zIndex: 500,
                        boxShadow: '0 8px 32px rgba(0,0,0,0.3)'
                    }}
                >
                    <h3 style={{
                        color: '#879fbf',
                        marginBottom: '1rem',
                        fontSize: '1.3rem',
                        fontWeight: 600
                    }}>
                        Comments
                    </h3>
                    
                    <div style={{ marginBottom: '1rem', maxHeight: '200px', overflowY: 'auto' }}>
                        {comments.length === 0 ? (
                            <div style={{
                                color: '#879fbf',
                                opacity: 0.6,
                                fontStyle: 'italic',
                                textAlign: 'center',
                                padding: '1rem'
                            }}>
                                No comments yet. Be the first!
                            </div>
                        ) : (
                            comments.map((comment, idx) => (
                                <div key={idx} style={{
                                    backgroundColor: '#f8f9fa',
                                    padding: '0.75rem',
                                    borderRadius: '8px',
                                    marginBottom: '0.75rem',
                                    borderLeft: '3px solid #879fbf',
                                    position: 'relative'
                                }}>
                                    <button
                                        onClick={() => handleDeleteComment(idx)}
                                        style={{
                                            position: 'absolute',
                                            top: '0.5rem',
                                            right: '0.5rem',
                                            background: 'none',
                                            border: 'none',
                                            color: '#d32f2f',
                                            cursor: 'pointer',
                                            fontSize: '0.85rem',
                                            padding: '0.25rem',
                                            opacity: 0.7
                                        }}
                                        title="Delete comment"
                                    >
                                        âœ•
                                    </button>
                                    <div style={{
                                        color: '#879fbf',
                                        fontWeight: 600,
                                        marginBottom: '0.25rem',
                                        fontSize: '0.95rem',
                                        paddingRight: '1.5rem'
                                    }}>
                                        {comment.author}
                                    </div>
                                    <div style={{
                                        color: '#879fbf',
                                        fontSize: '0.95rem'
                                    }}>
                                        {comment.text}
                                    </div>
                                </div>
                            ))
                        )}
                    </div>

                    <div style={{ borderTop: '1px solid #e0e0e0', paddingTop: '1rem' }}>
                        <input
                            type="text"
                            value={commenterName}
                            onChange={(e) => setCommenterName(e.target.value)}
                            placeholder="Your name..."
                            style={{
                                width: '100%',
                                padding: '0.75rem',
                                fontSize: '1rem',
                                border: '2px solid #c7f2ed',
                                borderRadius: '8px',
                                backgroundColor: '#fffefc',
                                color: '#879fbf',
                                fontFamily: "'Crimson Text', serif",
                                marginBottom: '0.75rem',
                                outline: 'none',
                                boxSizing: 'border-box'
                            }}
                        />
                        <textarea
                            value={newComment}
                            onChange={handleCommentChange}
                            placeholder="Add a comment..."
                            style={{
                                width: '100%',
                                padding: '0.75rem',
                                fontSize: '1rem',
                                border: '2px solid #c7f2ed',
                                borderRadius: '8px',
                                backgroundColor: '#fffefc',
                                color: '#879fbf',
                                fontFamily: "'Crimson Text', serif",
                                resize: 'vertical',
                                minHeight: '60px',
                                marginBottom: '0.5rem',
                                outline: 'none',
                                boxSizing: 'border-box'
                            }}
                        />
                        <div style={{
                            fontSize: '0.85rem',
                            color: newComment.length === MAX_CHARS ? '#d32f2f' : '#879fbf',
                            opacity: 0.7,
                            marginBottom: '0.5rem'
                        }}>
                            {newComment.length}/{MAX_CHARS}
                        </div>
                        <button
                            onClick={handleSubmit}
                            disabled={!newComment.trim() || !commenterName.trim()}
                            style={{
                                padding: '0.75rem 1.5rem',
                                fontSize: '1rem',
                                backgroundColor: (newComment.trim() && commenterName.trim()) ? '#879fbf' : '#ccc',
                                color: '#fff',
                                border: 'none',
                                borderRadius: '8px',
                                cursor: (newComment.trim() && commenterName.trim()) ? 'pointer' : 'not-allowed',
                                fontWeight: 600,
                                fontFamily: "'Crimson Text', serif"
                            }}
                        >
                            Post Comment
                        </button>
                    </div>
                </div>
            );
        };

        const BookBingoApp = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [currentPage, setCurrentPage] = useState('home');
            const [menuOpen, setMenuOpen] = useState(false);
            const [selectedName, setSelectedName] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('Casual');
            const [currentSquare, setCurrentSquare] = useState(null);
            const [bookTitle, setBookTitle] = useState('');
            const [bookAuthor, setBookAuthor] = useState('');
            const [userData, setUserData] = useState({});
            const [favorites, setFavorites] = useState({});
            const [loading, setLoading] = useState(true);
            const [commentModalOpen, setCommentModalOpen] = useState(null);
            const [commentCounts, setCommentCounts] = useState({});

            useEffect(() => {
                const authenticated = sessionStorage.getItem('stayLitAuthenticated');
                if (authenticated === 'true') {
                    setIsAuthenticated(true);
                }
            }, []);

            const users = ['Ryan Evans', 'Jac Evans', 'Ashley Crouthamel', 'Kim Beasley', 'Beth Palmer', 'Leila McGraw', 'Chris McGraw', 'Sam DiNardo', 'Michael Wilcher', 'Charles Sharman', 'Ashley Weekley', 'Jared Beasley', 'Wendy Hall', 'Haven Hall', 'Tracy Mills', 'Travis Jones', 'Lauren Bowen', 'Jordan Crouthamel', 'Kristen Phaneuf', 'Jenny Robertson', 'Isa Monell', 'Angela Wilcox', 'Jen Satterfield', 'Raquel Monell', 'Josh Vogt', 'April Devoe', 'TJ Stinnett', 'Angelica Evans', 'Andy Didway', 'Steven Harrington'];
            
            const casualCategories = [
                'Book with an Odd Number of Pages',
                "Genre You Don't Usually Read",
                'Graphic Novel or Manga',
                'Mystery or Thriller',
                'Author Who Won a Literary Prize',
                'Book by an Author Who is No Longer Alive',
                'Book Adapted Into a Movie/TV Series',
                'Read a Book by Listening to the Audiobook',
                'Read a Book With a Friend',
                'A Book with an Animal as a Character',
                'Debut Author',
                'Childhood Classic',
                'Ask Three People What They Are Curently Reading',
                'Author Not From the US',
                'One Word Title',
                "A Classic You've Never Read",
                'Published in the Year You Were Born',
                'Speculative Fiction (Beyond Realism, Imaginative Elements)',
                'Roll a Die to Determine What to Read: 1) Romance 2) Sci-Fi 3) Mystery 4) High Fantasy 5 ) Historical Fiction 6) Adventure',
                'Fantasy (High or Low)',
                'Book Chosen Soley Based on the Cover',
                'Set in the Distant Future',
                'BIPOC Author',
                'Read Historical Fiction',
                'Short Story Collection'
            ];

            const ambitiousCategories = [
                'Published Between 1940 and 1969',
                'Book with Multiple Points of View',
                'Mythology/Fairytale Retelling',
                'Book Written by an LGBTQIA+ Author',
                'Villain as a Protagonist',
                'Non-fiction on a New Subject',
                'Read a Book with 2 or More Friends',
                'Staff Pick From an Indie Bookstore',
                'Memoir, Biography, or Autobiography',
                'Indigenous Author',
                'Translated Work',
                'Book Tackling Social Issue(s)',
                'Published in 2025',
                'A Book Someone Whose Name Has 2 Syllables Recommended',
                'A Book Within One of These Subgenres: Cyberpunk, Dark Academia, or Space Opera',
                'A Book with Non-linear Narrative or Time Structure'
            ];

            const eliteCategories = [
                'Complete the Middle Square on the Casual Card...Then Read One of Those Books',
                'Have Someone Blindly Give You a Book Recommendation',
                'Banned Book',
                'Written Before 1910',
                'Read a Trilogy, or 3 Books by the Same Author',
                'Read 40+ Books in 2026',
                'Read a Book on Theme with a Heritage/History Month, in That Month',
                'Read a Book as a Part of a Book Club',
                'Pulitzer Prize Winner'
            ];

            useEffect(() => {
                if (!isAuthenticated) return;

                const loadCommentCounts = async () => {
                    const snapshot = await db.collection('comments').get();
                    const counts = {};
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        if (data.comments && data.comments.length > 0) {
                            counts[doc.id] = data.comments.length;
                        }
                    });
                    setCommentCounts(counts);
                };

                loadCommentCounts();
            }, [isAuthenticated, commentModalOpen]);

            useEffect(() => {
                if (!isAuthenticated) return;

                const unsubscribe = db.collection('cards').onSnapshot((snapshot) => {
                    const data = {};
                    const favs = {};
                    
                    snapshot.forEach((doc) => {
                        const docData = doc.data();
                        const docId = doc.id;
                        
                        Object.keys(docData).forEach((key) => {
                            if (key.startsWith('square_')) {
                                const squareIndex = key.replace('square_', '');
                                const fullKey = `${docId}-${squareIndex}`;
                                data[fullKey] = docData[key];
                            } else if (key.startsWith('favorite_')) {
                                const squareIndex = key.replace('favorite_', '');
                                const fullKey = `${docId}-${squareIndex}`;
                                favs[fullKey] = docData[key];
                            }
                        });
                    });
                    
                    setUserData(data);
                    setFavorites(favs);
                    setLoading(false);
                });

                return () => unsubscribe();
            }, [isAuthenticated]);

            const getGridSize = () => {
                if (selectedCategory === 'Casual') return 5;
                if (selectedCategory === 'Ambitious') return 4;
                return 3;
            };

            const getCategories = () => {
                if (selectedCategory === 'Casual') return casualCategories;
                if (selectedCategory === 'Ambitious') return ambitiousCategories;
                return eliteCategories;
            };

            const getDocId = () => {
                return `${selectedName}-${selectedCategory}`;
            };

            const getSquareState = (index) => {
                const key = `${getDocId()}-${index}`;
                return userData[key] || { status: 'not-started', book: '', author: '' };
            };

            const updateSquare = async (index, status, book = '', author = '') => {
                const docId = getDocId();
                const key = `${docId}-${index}`;
                
                const squareData = { status, book, author };
                setUserData(prev => ({
                    ...prev,
                    [key]: squareData
                }));

                try {
                    await db.collection('cards').doc(docId).set({
                        [`square_${index}`]: squareData
                    }, { merge: true });
                } catch (error) {
                    console.error('Error updating square:', error);
                }
            };

            const toggleFavorite = async (index, e) => {
                e.stopPropagation();
                const docId = getDocId();
                const key = `${docId}-${index}`;
                const state = getSquareState(index);
                
                if (!state.book) return;
                
                const newFavStatus = !favorites[key];
                setFavorites(prev => ({
                    ...prev,
                    [key]: newFavStatus
                }));

                try {
                    await db.collection('cards').doc(docId).set({
                        [`favorite_${index}`]: newFavStatus
                    }, { merge: true });
                } catch (error) {
                    console.error('Error updating favorite:', error);
                }
            };

            const isFavorited = (index) => {
                const key = `${getDocId()}-${index}`;
                return favorites[key] || false;
            };

            const getAllFavorites = () => {
                const favList = [];
                
                Object.keys(favorites).forEach(key => {
                    if (favorites[key] === true) {
                        const data = userData[key];
                        if (data && data.book) {
                            const parts = key.split('-');
                            const categoryIndex = parts.findIndex(p => 
                                p === 'Casual' || p === 'Ambitious' || p === 'Elite'
                            );
                            const name = parts.slice(0, categoryIndex).join('-');
                            
                            favList.push({
                                book: data.book,
                                author: data.author || '',
                                reader: name.replace(/-/g, ' ')
                            });
                        }
                    }
                });
                
                return favList;
            };

            const handleSquareClick = (index) => {
                if (!selectedName) return;
                setCurrentSquare(index);
                const state = getSquareState(index);
                setBookTitle(state.book || '');
                setBookAuthor(state.author || '');
            };

            const handleUpdateBook = async () => {
                if (bookTitle.trim() && currentSquare !== null) {
                    await updateSquare(currentSquare, 'in-progress', bookTitle, bookAuthor);
                    setBookTitle('');
                    setBookAuthor('');
                    setCurrentSquare(null);
                }
            };

            const handleMarkComplete = async () => {
    if (currentSquare !== null) {
        // Use the currently typed values if they exist, otherwise use saved state
        const bookToSave = bookTitle.trim() || getSquareState(currentSquare).book;
        const authorToSave = bookAuthor.trim() || getSquareState(currentSquare).author;
        
        await updateSquare(currentSquare, 'complete', bookToSave, authorToSave);
        setBookTitle('');
        setBookAuthor('');
        setCurrentSquare(null);
    }
};

            const handleClear = async () => {
                if (currentSquare !== null) {
                    const docId = getDocId();
                    const key = `${docId}-${currentSquare}`;
                    
                    await updateSquare(currentSquare, 'not-started', '', '');
                    
                    setFavorites(prev => {
                        const newFavorites = { ...prev };
                        delete newFavorites[key];
                        return newFavorites;
                    });

                    try {
                        await db.collection('cards').doc(docId).update({
                            [`favorite_${currentSquare}`]: firebase.firestore.FieldValue.delete()
                        });
                    } catch (error) {
                        console.error('Error clearing favorite:', error);
                    }

                    setBookTitle('');
                    setBookAuthor('');
                    setCurrentSquare(null);
                }
            };

            const getSquareColor = (status) => {
                if (status === 'complete') return '#e8ffe9';
                if (status === 'in-progress') return '#fdf4e9';
                return '#f0fffc';
            };

            const getBorderColor = (status) => {
                if (status === 'complete') return '#c8e6c9';
                if (status === 'in-progress') return '#f4e4c1';
                return '#c7f2ed';
            };

            if (!isAuthenticated) {
                return <LoginScreen onLogin={() => setIsAuthenticated(true)} />;
            }

            const gridSize = getGridSize();
            const categories = getCategories();
            const isMobile = window.innerWidth < 768;

            if (loading) {
                return (
                    <div style={{
                        minHeight: '100vh',
                        display: 'flex',
                        justifyContent: 'center',
                        alignItems: 'center',
                        backgroundColor: '#fffefc',
                        fontFamily: "'Crimson Text', serif",
                        fontSize: '1.5rem',
                        color: '#879fbf'
                    }}>
                        Loading...
                    </div>
                );
            }

            return (
                <div style={{
                    minHeight: '100vh',
                    backgroundColor: '#fffefc',
                    fontFamily: "'Crimson Text', serif",
                    color: '#879fbf'
                }}>
                    <header style={{
                        padding: '0.25rem 1rem',
                        borderBottom: '2px solid #879fbf',
                        display: 'flex',
                        justifyContent: 'center',
                        alignItems: 'center',
                        position: 'sticky',
                        top: 0,
                        backgroundColor: '#fffefc',
                        zIndex: 100
                    }}>
                        <a 
                            href="#"
                            onClick={(e) => {
                                e.preventDefault();
                                setCurrentPage('home');
                            }}
                            style={{
                                display: 'block',
                                cursor: 'pointer',
                                lineHeight: 0
                            }}
                        >
                            <img 
                                src="https://raw.githubusercontent.com/evansryan2498-oss/stayliterary/main/StayLitLogoV2.png"
                                alt="Stay Literary"
                                style={{
                                    height: 'clamp(90px, 12vw, 140px)',
                                    width: 'auto',
                                    maxWidth: '95%',
                                    display: 'block'
                                }}
                            />
                        </a>
                        <button
                            onClick={() => setMenuOpen(!menuOpen)}
                            style={{
                                background: 'none',
                                border: 'none',
                                cursor: 'pointer',
                                padding: '0.5rem',
                                color: '#879fbf',
                                display: 'flex',
                                alignItems: 'center',
                                position: 'absolute',
                                right: '1rem'
                            }}
                        >
                            {menuOpen ? <X /> : <Menu />}
                        </button>
                    </header>

                    {menuOpen && (
                        <>
                            <div style={{
                                position: 'fixed',
                                top: 0,
                                right: 0,
                                width: '70%',
                                maxWidth: '300px',
                                height: '100vh',
                                backgroundColor: '#fffefc',
                                boxShadow: '-2px 0 10px rgba(0,0,0,0.1)',
                                zIndex: 200,
                                padding: '1rem',
                                overflowY: 'auto'
                            }}>
                                <button
                                    onClick={() => setMenuOpen(false)}
                                    style={{
                                        position: 'absolute',
                                        top: '1rem',
                                        right: '1rem',
                                        background: 'none',
                                        border: 'none',
                                        cursor: 'pointer',
                                        color: '#879fbf'
                                    }}
                                >
                                    <X />
                                </button>
                                <nav style={{ marginTop: '3rem' }}>
                                    {[
                                        { id: 'home', label: 'Home', icon: BookOpen },
                                        { id: 'favorites', label: 'Favorites', icon: Heart },
                                        { id: 'parameters', label: 'Parameters', icon: Info },
                                        { id: 'points', label: 'Point System', icon: Award }
                                    ].map(({ id, label, icon: Icon }) => (
                                        <button
                                            key={id}
                                            onClick={() => {
                                                setCurrentPage(id);
                                                setMenuOpen(false);
                                            }}
                                            style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '1rem',
                                                width: '100%',
                                                padding: '1rem',
                                                marginBottom: '0.5rem',
                                                background: currentPage === id ? '#ebfffe' : 'transparent',
                                                border: 'none',
                                                borderRadius: '8px',
                                                cursor: 'pointer',
                                                fontSize: '1.2rem',
                                                color: '#879fbf',
                                                textAlign: 'left',
                                                fontFamily: "'Crimson Text', serif"
                                            }}
                                        >
                                            <Icon />
                                            {label}
                                        </button>
                                    ))}
                                </nav>
                            </div>
                            <div
                                onClick={() => setMenuOpen(false)}
                                style={{
                                    position: 'fixed',
                                    top: 0,
                                    left: 0,
                                    right: 0,
                                    bottom: 0,
                                    backgroundColor: 'rgba(0,0,0,0.3)',
                                    zIndex: 150
                                }}
                            />
                        </>
                    )}

                    <main style={{ padding: '1.5rem', maxWidth: '1200px', margin: '0 auto' }}>
                        {currentPage === 'home' && (
                            <>
                               <div style={{
    display: 'flex',
    flexDirection: 'column',
    gap: '1.5rem',
    marginBottom: '2rem'
}}>
    <div>
        <label style={{
            display: 'block',
            marginBottom: '0.75rem',
            fontSize: '1.2rem',
            fontWeight: 600
        }}>
            Name
        </label>
        <SearchableDropdown
            value={selectedName}
            onChange={setSelectedName}
            options={users}
            placeholder="Choose your name..."
        />
    </div>
    <div>
    <label style={{
        display: 'block',
        marginBottom: '0.75rem',
        fontSize: '1.2rem',
        fontWeight: 600
    }}>
        Card Tier
    </label>
    <SearchableDropdown
        value={selectedCategory}
        onChange={setSelectedCategory}
        options={['Casual', 'Ambitious', 'Elite']}
        placeholder="Choose card tier..."
    />
</div>
</div>                                   
                                {selectedName && (
                                    <div style={{
                                        display: 'grid',
                                        gridTemplateColumns: 
                                            isMobile 
                                                ? 'repeat(2, 1fr)' 
                                                : `repeat(${gridSize}, 1fr)`,
                                        gap: 'clamp(0.75rem, 2vw, 1.25rem)',
                                        marginBottom: '2rem'
                                    }}>
                                        {categories.map((category, index) => {
                                            const state = getSquareState(index);
                                            const favorited = isFavorited(index);
                                            const docId = getDocId();
                                            const commentDocId = `${docId}-square_${index}`;
                                            const commentCount = commentCounts[commentDocId] || 0;
                                            
                                            return (
                                                <div
                                                    key={index}
                                                    className="bingo-square"
                                                    style={{
                                                        backgroundColor: getSquareColor(state.status),
                                                        border: `2px solid ${getBorderColor(state.status)}`,
                                                        borderRadius: '12px',
                                                        padding: 'clamp(0.75rem, 3vw, 1.25rem)',
                                                        display: 'flex',
                                                        flexDirection: 'column',
                                                        justifyContent: 'center',
                                                        alignItems: 'center',
                                                        textAlign: 'center',
                                                        minHeight: 'clamp(100px, 22vw, 140px)',
                                                        transition: 'all 0.2s',
                                                        position: 'relative'
                                                    }}
                                                >
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            handleSquareClick(index);
                                                        }}
                                                        style={{
                                                            position: 'absolute',
                                                            top: '0.5rem',
                                                            right: '0.5rem',
                                                            background: 'rgba(255, 255, 255, 0.8)',
                                                            border: 'none',
                                                            borderRadius: '50%',
                                                            width: '28px',
                                                            height: '28px',
                                                            cursor: 'pointer',
                                                            padding: '0',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            zIndex: 10,
                                                            transition: 'background 0.2s'
                                                        }}
                                                    >
                                                        <MoreVertical size={18} stroke="#879fbf" />
                                                    </button>

                                                    {state.book && (
                                                        <button
                                                            onClick={(e) => toggleFavorite(index, e)}
                                                            style={{
                                                                position: 'absolute',
                                                                top: '0.5rem',
                                                                left: '0.5rem',
                                                                background: 'none',
                                                                border: 'none',
                                                                cursor: 'pointer',
                                                                padding: '0.25rem',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                zIndex: 10
                                                            }}
                                                        >
                                                            <Star 
                                                                size={20} 
                                                                fill={favorited ? '#ffd700' : 'none'}
                                                                stroke={favorited ? '#ffd700' : '#879fbf'}
                                                                strokeWidth={2}
                                                            />
                                                        </button>
                                                    )}
                                                    
                                                    {state.status === 'complete' && (
                                                        <div style={{
                                                            position: 'absolute',
                                                            bottom: '0.5rem',
                                                            left: '0.5rem',
                                                            fontSize: '1.5rem',
                                                            color: '#4caf50'
                                                        }}>
                                                            âœ“
                                                        </div>
                                                    )}
                                                    
                                                    <button
                                                        className="comment-bubble"
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            setCommentModalOpen(index);
                                                        }}
                                                        style={{
                                                            position: 'absolute',
                                                            bottom: '0.5rem',
                                                            right: '0.5rem',
                                                            background: 'rgba(135, 159, 191, 0.15)',
                                                            border: '1px solid #879fbf',
                                                            borderRadius: '50%',
                                                            width: '28px',
                                                            height: '28px',
                                                            cursor: 'pointer',
                                                            padding: '0',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            zIndex: 10,
                                                            opacity: commentCount > 0 ? '1' : '0',
                                                            transition: 'all 0.2s',
                                                            color: '#879fbf'
                                                        }}
                                                    >
                                                        <MessageCircle size={14} />
                                                        {commentCount > 0 && (
                                                            <span style={{
                                                                position: 'absolute',
                                                                top: '-5px',
                                                                right: '-5px',
                                                                background: '#879fbf',
                                                                color: '#fff',
                                                                borderRadius: '50%',
                                                                width: '16px',
                                                                height: '16px',
                                                                fontSize: '0.65rem',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                fontWeight: 'bold'
                                                            }}>
                                                                {commentCount}
                                                            </span>
                                                        )}
                                                    </button>
                                                    
                                                    <div style={{
                                                        fontSize: 'clamp(0.95rem, 2.8vw, 1.15rem)',
                                                        fontWeight: 600,
                                                        marginBottom: state.book ? '0.5rem' : 0,
                                                        lineHeight: 1.3
                                                    }}>
                                                        {category}
                                                    </div>
                                                    {state.book && (
                                                        <>
                                                            <div style={{
                                                                fontSize: 'clamp(0.85rem, 2.3vw, 1rem)',
                                                                fontStyle: 'italic',
                                                                opacity: 0.85,
                                                                lineHeight: 1.2,
                                                                marginBottom: state.author ? '0.25rem' : 0
                                                            }}>
                                                                {state.book}
                                                            </div>
                                                            {state.author && (
                                                                <div style={{
                                                                    fontSize: 'clamp(0.75rem, 2vw, 0.9rem)',
                                                                    opacity: 0.7,
                                                                    lineHeight: 1.2
                                                                }}>
                                                                    by {state.author}
                                                                </div>
                                                            )}
                                                        </>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}

                                {selectedName && (
                                    <div style={{
                                        display: 'flex',
                                        flexWrap: 'wrap',
                                        gap: '1.25rem',
                                        justifyContent: 'center',
                                        padding: '1.25rem',
                                        backgroundColor: '#f8f9fa',
                                        borderRadius: '12px'
                                    }}>
                                        {[
                                            { label: 'Not Started', color: '#f0fffc', border: '#c7f2ed' },
                                            { label: 'In Progress', color: '#fdf4e9', border: '#f4e4c1' },
                                            { label: 'Complete', color: '#e8ffe9', border: '#c8e6c9' }
                                        ].map(({ label, color, border }) => (
                                            <div key={label} style={{ display: 'flex', alignItems: 'center', gap: '0.65rem' }}>
                                                <div style={{
                                                    width: '28px',
                                                    height: '28px',
                                                    backgroundColor: color,
                                                    border: `2px solid ${border}`,
                                                    borderRadius: '6px'
                                                }} />
                                                <span style={{ fontSize: 'clamp(1rem, 2.8vw, 1.15rem)' }}>{label}</span>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </>
                        )}

                        {currentPage === 'favorites' && (
                            <div style={{
                                backgroundColor: '#fff',
                                padding: 'clamp(1.5rem, 5vw, 2.5rem)',
                                borderRadius: '12px',
                                boxShadow: '0 2px 12px rgba(0,0,0,0.08)',
                                overflowX: 'auto'
                            }}>
                                <h2 style={{ 
                                    fontSize: 'clamp(1.75rem, 5vw, 2.25rem)', 
                                    marginBottom: '1.75rem',
                                    fontWeight: 600
                                }}>
                                    Favorites
                                </h2>
                                {getAllFavorites().length === 0 ? (
                                    <p style={{ 
                                        fontSize: 'clamp(1.1rem, 3vw, 1.25rem)',
                                        color: '#879fbf',
                                        fontStyle: 'italic'
                                    }}>
                                        No favorites yet! Star some books to see them here.
                                    </p>
                                ) : (
                                    <table style={{
                                        width: '100%',
                                        borderCollapse: 'collapse',
                                        fontSize: 'clamp(1rem, 2.5vw, 1.15rem)'
                                    }}>
                                        <thead>
                                            <tr style={{ 
                                                backgroundColor: '#f0fffc',
                                                borderBottom: '2px solid #879fbf'
                                            }}>
                                                <th style={{ 
                                                    padding: '1rem',
                                                    textAlign: 'left',
                                                    fontWeight: 600,
                                                    color: '#879fbf'
                                                }}>Book</th>
                                                <th style={{ 
                                                    padding: '1rem',
                                                    textAlign: 'left',
                                                    fontWeight: 600,
                                                    color: '#879fbf'
                                                }}>Author</th>
                                                <th style={{ 
                                                    padding: '1rem',
                                                    textAlign: 'left',
                                                    fontWeight: 600,
                                                    color: '#879fbf'
                                                }}>Reader</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {getAllFavorites().map((fav, index) => (
                                                <tr key={index} style={{
                                                    borderBottom: '1px solid #e0e0e0'
                                                }}>
                                                    <td style={{ 
                                                        padding: '1rem',
                                                        color: '#879fbf'
                                                    }}>{fav.book}</td>
                                                    <td style={{ 
                                                        padding: '1rem',
                                                        color: '#879fbf'
                                                    }}>{fav.author || 'â€”'}</td>
                                                    <td style={{ 
                                                        padding: '1rem',
                                                        color: '#879fbf'
                                                    }}>{fav.reader}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                )}
                            </div>
                        )}

                        {currentPage === 'parameters' && (
                            <div style={{
                                backgroundColor: '#fff',
                                padding: 'clamp(1.5rem, 5vw, 2.5rem)',
                                borderRadius: '12px',
                                boxShadow: '0 2px 12px rgba(0,0,0,0.08)'
                            }}>
                                <h2 style={{ 
                                    fontSize: 'clamp(1.75rem, 5vw, 2.25rem)', 
                                    marginBottom: '1.75rem',
                                    fontWeight: 600
                                }}>
                                    Parameters
                                </h2>
                                <div style={{ 
                                    fontSize: 'clamp(1.1rem, 3vw, 1.25rem)', 
                                    lineHeight: 1.9
                                }}>
                                    <div style={{ marginBottom: '1rem' }}>
                                        <span style={{ color: '#879fbf', marginRight: '0.75rem' }}>â€”</span>
                                        Any format of reading counts - physical book, audiobook, or ebook.
                                    </div>
                                    <div style={{ marginBottom: '1rem' }}>
                                        <span style={{ color: '#879fbf', marginRight: '0.75rem' }}>â€”</span>
                                        The goal is to get bingo, but to qualify for a prize you will need to 'blackout' a bingo card.
                                    </div>
                                    <div style={{ marginBottom: '1rem' }}>
                                        <span style={{ color: '#879fbf', marginRight: '0.75rem' }}>â€”</span>
                                        You can use one book for multiple spots on different tiered bingo cards.
                                    </div>
                                    <div style={{ marginBottom: '1rem' }}>
                                        <span style={{ color: '#879fbf', marginRight: '0.75rem' }}>â€”</span>
                                        You cannot use one book for multiple spots on the same bingo card.
                                    </div>
                                    <div style={{ marginBottom: '1rem' }}>
                                        <span style={{ color: '#879fbf', marginRight: '0.75rem' }}>â€”</span>
                                        Kindly do not judge others for what they read, how they read, or how much they read.
                                    </div>
                                    <div style={{ marginBottom: '1rem' }}>
                                        <span style={{ color: '#879fbf', marginRight: '0.75rem' }}>â€”</span>
                                        Inclusivity is paramount to 'staying lit(erary).'
                                    </div>
                                    <div style={{ marginBottom: '1rem' }}>
                                        <span style={{ color: '#879fbf', marginRight: '0.75rem' }}>â€”</span>
                                        You cannot reuse a book from another grid for the Bonus Card. It is a standalone card and requires unique titles.
                                    </div>
                                </div>
                            </div>
                        )}

                        {currentPage === 'points' && (
                            <div style={{
                                backgroundColor: '#fff',
                                padding: 'clamp(1.5rem, 5vw, 2.5rem)',
                                borderRadius: '12px',
                                boxShadow: '0 2px 12px rgba(0,0,0,0.08)'
                            }}>
                                <h2 style={{ 
                                    fontSize: 'clamp(1.75rem, 5vw, 2.25rem)', 
                                    marginBottom: '1.75rem',
                                    fontWeight: 600
                                }}>
                                    Point System
                                </h2>
                                <p style={{ 
                                    fontSize: 'clamp(1.1rem, 3vw, 1.25rem)', 
                                    lineHeight: 1.9 
                                }}>
                                    Point system details coming soon!
                                </p>
                            </div>
                        )}
                    </main>

                    {currentSquare !== null && (
                        <>
                            <div
                                onClick={() => setCurrentSquare(null)}
                                style={{
                                    position: 'fixed',
                                    top: 0,
                                    left: 0,
                                    right: 0,
                                    bottom: 0,
                                    backgroundColor: 'rgba(0,0,0,0.5)',
                                    zIndex: 300
                                }}
                            />
                            <div style={{
                                position: 'fixed',
                                top: '50%',
                                left: '50%',
                                transform: 'translate(-50%, -50%)',
                                backgroundColor: '#fff',
                                borderRadius: '16px',
                                padding: 'clamp(1.75rem, 5vw, 2.5rem)',
                                width: '90%',
                                maxWidth: '450px',
                                zIndex: 400,
                                boxShadow: '0 8px 32px rgba(0,0,0,0.3)'
                            }}>
                                <h3 style={{
                                    fontSize: 'clamp(1.4rem, 4vw, 1.75rem)',
                                    marginBottom: '1.25rem',
                                    color: '#879fbf',
                                    fontWeight: 600
                                }}>
                                    Update Square
                                </h3>
                                <input
                                    type="text"
                                    value={bookTitle}
                                    onChange={(e) => setBookTitle(e.target.value)}
                                    placeholder="Enter book title..."
                                    style={{
                                        width: '100%',
                                        padding: '1rem',
                                        fontSize: '1.1rem',
                                        border: '2px solid #879fbf',
                                        borderRadius: '10px',
                                        marginBottom: '1rem',
                                        fontFamily: "'Crimson Text', serif",
                                        outline: 'none',
                                        boxSizing: 'border-box'
                                    }}
                                />
                                <input
                                    type="text"
                                    value={bookAuthor}
                                    onChange={(e) => setBookAuthor(e.target.value)}
                                    placeholder="Enter author (optional)..."
                                    style={{
                                        width: '100%',
                                        padding: '1rem',
                                        fontSize: '1.1rem',
                                        border: '2px solid #879fbf',
                                        borderRadius: '10px',
                                        marginBottom: '1.25rem',
                                        fontFamily: "'Crimson Text', serif",
                                        outline: 'none',
                                        boxSizing: 'border-box'
                                    }}
                                />
                                <div style={{
                                    display: 'flex',
                                    flexDirection: 'column',
                                    gap: '0.85rem'
                                }}>
                                    <button
                                        onClick={handleUpdateBook}
                                        disabled={!bookTitle.trim()}
                                        style={{
                                            width: '100%',
                                            padding: '1rem',
                                            fontSize: '1.1rem',
                                            backgroundColor: bookTitle.trim() ? '#879fbf' : '#ccc',
                                            color: '#fff',
                                            border: 'none',
                                            borderRadius: '10px',
                                            cursor: bookTitle.trim() ? 'pointer' : 'not-allowed',
                                            fontWeight: 600,
                                            fontFamily: "'Crimson Text', serif",
                                            transition: 'all 0.2s'
                                        }}
                                    >
                                        Save Book
                                    </button>
                                    <button
                                        onClick={handleMarkComplete}
                                        style={{
                                            width: '100%',
                                            padding: '1rem',
                                            fontSize: '1.1rem',
                                            backgroundColor: '#e8ffe9',
                                            color: '#2e7d32',
                                            border: '2px solid #c8e6c9',
                                            borderRadius: '10px',
                                            cursor: 'pointer',
                                            fontWeight: 600,
                                            fontFamily: "'Crimson Text', serif",
                                            transition: 'all 0.2s'
                                        }}
                                    >
                                        Mark Complete
                                    </button>
                                    <button
                                        onClick={handleClear}
                                        style={{
                                            width: '100%',
                                            padding: '1rem',
                                            fontSize: '1.1rem',
                                            backgroundColor: '#fff',
                                            color: '#879fbf',
                                            border: '2px solid #879fbf',
                                            borderRadius: '10px',
                                            cursor: 'pointer',
                                            fontWeight: 600,
                                            fontFamily: "'Crimson Text', serif",
                                            transition: 'all 0.2s'
                                        }}
                                    >
                                        Clear
                                    </button>
                                    <button
                                        onClick={() => setCurrentSquare(null)}
                                        style={{
                                            width: '100%',
                                            padding: '1rem',
                                            fontSize: '1.1rem',
                                            backgroundColor: '#f8f9fa',
                                            color: '#6c757d',
                                            border: 'none',
                                            borderRadius: '10px',
                                            cursor: 'pointer',
                                            fontFamily: "'Crimson Text', serif",
                                            transition: 'all 0.2s'
                                        }}
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </>
                    )}

                    {commentModalOpen !== null && (
                        <>
                            <div
                                onClick={() => setCommentModalOpen(null)}
                                style={{
                                    position: 'fixed',
                                    top: 0,
                                    left: 0,
                                    right: 0,
                                    bottom: 0,
                                    backgroundColor: 'rgba(0,0,0,0.5)',
                                    zIndex: 400
                                }}
                            />
                            <CommentModal
                                docId={getDocId()}
                                squareIndex={commentModalOpen}
                                onClose={() => setCommentModalOpen(null)}
                                selectedName={selectedName}
                            />
                        </>
                    )}
                    
                    <style>
                        {`
                            .bingo-square .comment-bubble {
                                opacity: 0 !important;
                            }
                            .bingo-square:hover .comment-bubble {
                                opacity: 1 !important;
                            }
                            .comment-bubble:has(span) {
                                opacity: 1 !important;
                            }
                            @media (max-width: 768px) {
                                .bingo-square .comment-bubble {
                                    opacity: 1 !important;
                                }
                            }
                        `}
                    </style>
                </div>
            );
        };

        ReactDOM.render(<BookBingoApp />, document.getElementById('root'));
    </script>
</body>
</html>
